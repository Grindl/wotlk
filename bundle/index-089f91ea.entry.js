var t=Object.defineProperty,e=(e,a,s)=>(((e,a,s)=>{a in e?t(e,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[a]=s})(e,"symbol"!=typeof a?a+"":a,s),s);import{T as a}from"./index-50a990e3.chunk.js";import{S as s,fn as r,aU as i,C as n,b_ as l,T as o,y as c,z as d,fo as p,a$ as m,u as h,s as u,L as f,$ as g,av as y,ak as I,cc as S,fp as P,fq as b,A as D,eH as E,eG as k,fr as C,fs as v,e4 as T,ft as w,f6 as R,f0 as O,eF as U,fu as W,fh as F,eI as x,a as A,ba as L,fv as B,aI as M,fw as H,I as $,ap as j,aj as V,fx as q,Y as z,fy as N,b9 as J,b5 as G,cw as K,bF as _,fz as X,cv as Q,cE as Y,a0 as Z,b$ as tt,fA as et,aC as at,x as st,bH as rt,bI as it,a8 as nt,aq as lt,ec as ot,ed as ct,br as dt}from"./detailed_results-88439820.chunk.js";import{aa as pt,ab as mt,ac as ht,P as ut,ad as ft,ae as gt,af as yt,B as It,ag as St,C as Pt,ah as bt,ai as Dt,F as Et,aj as kt,ak as Ct,al as vt,am as Tt,an as wt,S as Rt,ao as Ot}from"./preset_utils-a31de15d.chunk.js";import{T as Ut}from"./sim-eeddf813.chunk.js";import{D as Wt}from"./sim-3d061678.chunk.js";import{B as Ft}from"./sim-f2a3c49e.chunk.js";import{F as xt}from"./sim-774e99ed.chunk.js";import{F as At}from"./sim-7a96748c.chunk.js";import{R as Lt}from"./sim-918bcdfa.chunk.js";import{E as Bt}from"./sim-d055eeb5.chunk.js";import{E as Mt}from"./sim-09273aa3.chunk.js";import{R as Ht}from"./sim-8e59136e.chunk.js";import{H as $t}from"./sim-205c8c02.chunk.js";import{M as jt}from"./sim-f0a03e78.chunk.js";import{R as Vt}from"./sim-656e77f8.chunk.js";import{H as qt}from"./sim-0dcf99c5.chunk.js";import{P as zt}from"./sim-638a4514.chunk.js";import{R as Nt}from"./sim-0b368ee0.chunk.js";import{H as Jt}from"./sim-6b12ac43.chunk.js";import{S as Gt}from"./sim-5c0481b2.chunk.js";import{S as Kt}from"./sim-a9d3384a.chunk.js";import{W as _t}from"./sim-5ac81225.chunk.js";import{P as Xt}from"./sim-3056ea10.chunk.js";import{W as Qt}from"./sim-2accffde.chunk.js";import"./suggest_gems_action-281dc90e.chunk.js";import"./apl_utils-79302598.chunk.js";import"./totem_inputs-9cf64dca.chunk.js";import"./presets-10e3b7e7.chunk.js";const Yt={[s.SpecTankDeathknight]:(t,e)=>new Ut(t,e),[s.SpecDeathknight]:(t,e)=>new Wt(t,e),[s.SpecBalanceDruid]:(t,e)=>new Ft(t,e),[s.SpecFeralDruid]:(t,e)=>new xt(t,e),[s.SpecFeralTankDruid]:(t,e)=>new At(t,e),[s.SpecRestorationDruid]:(t,e)=>new Lt(t,e),[s.SpecElementalShaman]:(t,e)=>new Bt(t,e),[s.SpecEnhancementShaman]:(t,e)=>new Mt(t,e),[s.SpecRestorationShaman]:(t,e)=>new Ht(t,e),[s.SpecHunter]:(t,e)=>new $t(t,e),[s.SpecMage]:(t,e)=>new jt(t,e),[s.SpecRogue]:(t,e)=>new Vt(t,e),[s.SpecHolyPaladin]:(t,e)=>new qt(t,e),[s.SpecProtectionPaladin]:(t,e)=>new zt(t,e),[s.SpecRetributionPaladin]:(t,e)=>new Nt(t,e),[s.SpecHealingPriest]:(t,e)=>new Jt(t,e),[s.SpecShadowPriest]:(t,e)=>new Gt(t,e),[s.SpecSmitePriest]:(t,e)=>new Kt(t,e),[s.SpecWarrior]:(t,e)=>new _t(t,e),[s.SpecProtectionWarrior]:(t,e)=>new Xt(t,e),[s.SpecWarlock]:(t,e)=>new Qt(t,e)},Zt=r.map(pt).map((t=>t.raidSimPresets)).flat(),te=[...new Set(Zt.map((t=>t.spec)))],ee=-1,ae=Math.min(...Zt.map((t=>Math.max(...Object.keys(t.defaultGear[i.Alliance]).map((t=>parseInt(t)))))));class se extends n{constructor(t,a){super(t,"raid-picker-root"),e(this,"raidSimUI"),e(this,"raid"),e(this,"partyPickers"),e(this,"newPlayerPicker"),e(this,"currentDragPlayer",null),e(this,"currentDragPlayerFromIndex",ee),e(this,"currentDragType",1),e(this,"currentDragParty",null),this.raidSimUI=a,this.raid=a.sim.raid;const s=document.createElement("div");s.classList.add("raid-controls"),this.rootElem.appendChild(s),this.newPlayerPicker=new le(this.rootElem,this),new mt(s,this.raidSimUI.sim.raid,{label:"Raid Size",labelTooltip:"Number of players participating in the sim.",values:[{name:"5",value:1},{name:"10",value:2},{name:"25",value:5},{name:"40",value:8}],changedEvent:t=>t.numActivePartiesChangeEmitter,getValue:t=>t.getNumActiveParties(),setValue:(t,e,a)=>{e.setNumActiveParties(t,a)}}),new mt(s,this.newPlayerPicker,{label:"Default Faction",labelTooltip:"Default faction for newly-created players.",values:[{name:"Alliance",value:i.Alliance},{name:"Horde",value:i.Horde}],changedEvent:t=>this.raid.sim.factionChangeEmitter,getValue:t=>this.raid.sim.getFaction(),setValue:(t,e,a)=>{this.raid.sim.setFaction(t,a)}}),new mt(s,this.newPlayerPicker,{label:"Default Gear",labelTooltip:"Newly-created players will start with approximate BIS gear from this phase.",values:[...Array(ae).keys()].map((t=>{const e=t+1;return{name:"Phase "+e,value:e}})),changedEvent:t=>this.raid.sim.phaseChangeEmitter,getValue:t=>this.raid.sim.getPhase(),setValue:(t,e,a)=>{this.raid.sim.setPhase(t,a)}});const r=document.createElement("div");r.classList.add("parties-container"),this.rootElem.appendChild(r),this.partyPickers=this.raid.getParties().map(((t,e)=>new re(r,t,e,this)));const n=()=>{this.partyPickers.forEach((t=>{t.index<this.raidSimUI.sim.raid.getNumActiveParties()?t.rootElem.classList.add("active"):t.rootElem.classList.remove("active")}))};this.raidSimUI.sim.raid.numActivePartiesChangeEmitter.on(n),n(),this.rootElem.ondragend=t=>{this.clearDragPlayer(),this.clearDragParty()}}getCurrentFaction(){return this.raid.sim.getFaction()}getCurrentPhase(){return this.raid.sim.getPhase()}getPlayerPicker(t){return this.partyPickers[Math.floor(t/ht)].playerPickers[t%ht]}getPlayerPickers(){return[...new Array(25).keys()].map((t=>this.getPlayerPicker(t)))}setDragPlayer(t,e,a){if(this.clearDragPlayer(),this.currentDragPlayer=t,this.currentDragPlayerFromIndex=e,this.currentDragType=a,e!=ee){this.getPlayerPicker(e).rootElem.classList.add("dragfrom")}}clearDragPlayer(){if(this.currentDragPlayerFromIndex!=ee){this.getPlayerPicker(this.currentDragPlayerFromIndex).rootElem.classList.remove("dragfrom")}this.currentDragPlayer=null,this.currentDragPlayerFromIndex=ee,this.currentDragType=1}setDragParty(t){this.currentDragParty=t,t.rootElem.classList.add("dragfrom")}clearDragParty(){this.currentDragParty&&(this.currentDragParty.rootElem.classList.remove("dragfrom"),this.currentDragParty=null)}}class re extends n{constructor(t,a,s,r){super(t,"party-picker-root"),e(this,"party"),e(this,"index"),e(this,"raidPicker"),e(this,"playerPickers"),this.party=a,this.index=s,this.raidPicker=r,this.rootElem.setAttribute("draggable","true"),this.rootElem.innerHTML=`\n\t\t\t<div class="party-header">\n\t\t\t\t<label class="party-label form-label">Group ${s+1}</label>\n\t\t\t\t<div class="party-results">\n\t\t\t\t\t<span class="party-results-dps"></span>\n\t\t\t\t\t<span class="party-results-reference-delta"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="players-container">\n\t\t\t</div>\n\t\t`;const i=this.rootElem.getElementsByClassName("players-container")[0];this.playerPickers=[...Array(ht).keys()].map((t=>new ie(i,this,t)));const n=this.rootElem.getElementsByClassName("party-results-dps")[0],c=this.rootElem.getElementsByClassName("party-results-reference-delta")[0];this.raidPicker.raidSimUI.referenceChangeEmitter.on((()=>{const t=this.raidPicker.raidSimUI.getCurrentData(),e=this.raidPicker.raidSimUI.getReferenceData(),a=t?.simResult.raidMetrics.parties[this.index]?.dps.avg||0,s=e?.simResult.raidMetrics.parties[this.index]?.dps.avg||0;if(0==a&&0==s)return n.textContent="",void(c.textContent="");n.textContent=`${a.toFixed(1)} DPS`,e?l(c,s,a,1):c.textContent=""})),this.rootElem.ondragstart=t=>{t.target==this.rootElem&&(t.dataTransfer.dropEffect="move",t.dataTransfer.effectAllowed="all",this.raidPicker.setDragParty(this))};let d=0;this.rootElem.ondragenter=t=>{t.preventDefault(),this.raidPicker.currentDragParty&&(d++,this.rootElem.classList.add("dragto"))},this.rootElem.ondragleave=t=>{t.preventDefault(),this.raidPicker.currentDragParty&&(d--,d<=0&&this.rootElem.classList.remove("dragto"))},this.rootElem.ondragover=t=>{t.preventDefault()},this.rootElem.ondrop=t=>{if(!this.raidPicker.currentDragParty)return;t.preventDefault(),d=0,this.rootElem.classList.remove("dragto");const e=o.nextEventID();o.freezeAllAndDo((()=>{const t=this.raidPicker.currentDragParty;for(let a=0;a<ht;a++){const s=t.playerPickers[a],r=this.playerPickers[a],i=s.player,n=r.player;s.setPlayer(e,n,3),r.setPlayer(e,i,3)}})),this.raidPicker.clearDragParty()}}}class ie extends n{constructor(t,a,s){super(t,"player-picker-root"),e(this,"index"),e(this,"raidIndex"),e(this,"player"),e(this,"partyPicker"),e(this,"raidPicker"),e(this,"labelElem"),e(this,"iconElem"),e(this,"nameElem"),e(this,"resultsElem"),e(this,"dpsResultElem"),e(this,"referenceDeltaElem"),this.index=s,this.raidIndex=a.index*ht+s,this.player=null,this.partyPicker=a,this.raidPicker=a.raidPicker,this.labelElem=null,this.iconElem=null,this.nameElem=null,this.resultsElem=null,this.dpsResultElem=null,this.referenceDeltaElem=null,this.rootElem.classList.add("player"),this.partyPicker.party.compChangeEmitter.on((t=>{const e=this.partyPicker.party.getPlayer(this.index);e!=this.player&&this.setPlayer(t,e,0)})),this.raidPicker.raidSimUI.referenceChangeEmitter.on((()=>{const t=this.raidPicker.raidSimUI.getCurrentData(),e=this.raidPicker.raidSimUI.getReferenceData(),a=t?.simResult.getPlayerWithRaidIndex(this.raidIndex)?.dps.avg||0,s=e?.simResult.getPlayerWithRaidIndex(this.raidIndex)?.dps.avg||0;this.player&&(this.resultsElem?.classList.remove("hide"),this.dpsResultElem.textContent=`${a.toFixed(1)} DPS`,e&&l(this.referenceDeltaElem,s,a,1))}));let r=0;this.rootElem.ondragenter=t=>{t.preventDefault(),this.raidPicker.currentDragParty||(r++,this.rootElem.classList.add("dragto"))},this.rootElem.ondragleave=t=>{t.preventDefault(),this.raidPicker.currentDragParty||(r--,r<=0&&this.rootElem.classList.remove("dragto"))},this.rootElem.ondragover=t=>t.preventDefault(),this.rootElem.ondrop=t=>{if(this.raidPicker.currentDragParty)return;var e=t.dataTransfer.getData("text/plain");t.preventDefault(),r=0,this.rootElem.classList.remove("dragto");const a=o.nextEventID();o.freezeAllAndDo((()=>{if(null==this.raidPicker.currentDragPlayer&&0==e.length)return;if(this.raidPicker.currentDragPlayerFromIndex==this.raidIndex)return void this.raidPicker.clearDragPlayer();const t=this.raidPicker.currentDragType;if(this.raidPicker.currentDragPlayerFromIndex!=ee){const e=this.raidPicker.getPlayerPicker(this.raidPicker.currentDragPlayerFromIndex);3==t?e.setPlayer(a,this.player,t):2==t&&e.setPlayer(a,null,t)}else if(null==this.raidPicker.currentDragPlayer){const t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<r.length;e++)r[e]=t.charCodeAt(e);const i=c.fromBinary(r);var s=new ut(d(i),this.raidPicker.raidSimUI.sim);s.fromProto(a,i),this.raidPicker.currentDragPlayer=s}4==t?this.setPlayer(a,this.raidPicker.currentDragPlayer.clone(a),t):this.setPlayer(a,this.raidPicker.currentDragPlayer,t),this.raidPicker.clearDragPlayer()}))},this.update()}setPlayer(t,e,a){e!=this.player&&(o.freezeAllAndDo((()=>{this.player=e,e?(this.partyPicker.party.setPlayer(t,this.index,e),1==a&&function(t,e,a){if(y(e.spec)){const s=a.getTanks(),r=s.findIndex((t=>null==a.getPlayerFromUnitReference(t)));-1==r?s.length<3&&a.setTanks(t,s.concat([e.makeUnitReference()])):(s[r]=e.makeUnitReference(),a.setTanks(t,s))}if(e.spec==s.SpecBalanceDruid){const a=e.getSpecOptions();a.innervateTarget=I(e.getRaidIndex()),e.setSpecOptions(t,a)}else if(e.spec==s.SpecSmitePriest){const a=e.getSpecOptions();a.powerInfusionTarget=I(e.getRaidIndex()),e.setSpecOptions(t,a)}else if(e.spec==s.SpecMage){const a=e.getSpecOptions();a.focusMagicTarget=I(e.getRaidIndex()),e.setSpecOptions(t,a)}}(t,e,this.raidPicker.raid)):(this.partyPicker.party.setPlayer(t,this.index,e),this.partyPicker.party.compChangeEmitter.emit(t))})),this.update())}update(){if(null==this.player)this.rootElem.className="player-picker-root player",this.rootElem.innerHTML="",this.labelElem=null,this.iconElem=null,this.nameElem=null,this.resultsElem=null,this.dpsResultElem=null,this.referenceDeltaElem=null;else{const t=p(this.player.getClass());this.rootElem.className=`player-picker-root player bg-${t}-dampened`,this.rootElem.innerHTML=`\n\t\t\t\t<div class="player-label">\n\t\t\t\t\t<img class="player-icon" src="${this.player.getSpecIcon()}" draggable="true" />\n\t\t\t\t\t<div class="player-details">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tclass="player-name text-${t}"\n\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\tvalue="${this.player.getName()}"\n\t\t\t\t\t\t\tspellcheck="false"\n\t\t\t\t\t\t\tmaxlength="15"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div class="player-results hide">\n\t\t\t\t\t\t\t<span class="player-results-dps"></span>\n\t\t\t\t\t\t\t<span class="player-results-reference-delta"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="player-options">\n\t\t\t\t\t<a\n\t\t\t\t\t\thref="javascript:void(0)"\n\t\t\t\t\t\tclass="player-edit"\n\t\t\t\t\t\trole="button"\n\t\t\t\t\t\tdata-bs-toggle="tooltip"\n\t\t\t\t\t\tdata-bs-title="Click to Edit"\n\t\t\t\t\t>\n\t\t\t\t\t\t<i class="fa fa-edit fa-lg"></i>\n\t\t\t\t\t</a>\n\t\t\t\t\t<a\n\t\t\t\t\t\thref="javascript:void(0)"\n\t\t\t\t\t\tclass="player-copy link-warning"\n\t\t\t\t\t\trole="button"\n\t\t\t\t\t\tdraggable="true"\n\t\t\t\t\t\tdata-bs-toggle="tooltip"\n\t\t\t\t\t\tdata-bs-title="Drag to Copy"\n\t\t\t\t\t>\n\t\t\t\t\t\t<i class="fa fa-copy fa-lg"></i>\n\t\t\t\t\t</a>\n\t\t\t\t\t<a\n\t\t\t\t\t\thref="javascript:void(0)"\n\t\t\t\t\t\tclass="player-delete link-danger"\n\t\t\t\t\t\trole="button"\n\t\t\t\t\t\tdata-bs-toggle="tooltip"\n\t\t\t\t\t\tdata-bs-title="Click to Delete"\n\t\t\t\t\t>\n\t\t\t\t\t\t<i class="fa fa-times fa-lg"></i>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t`,this.labelElem=this.rootElem.querySelector(".player-label"),this.iconElem=this.rootElem.querySelector(".player-icon"),this.nameElem=this.rootElem.querySelector(".player-name"),this.resultsElem=this.rootElem.querySelector(".player-results"),this.dpsResultElem=this.rootElem.querySelector(".player-results-dps"),this.referenceDeltaElem=this.rootElem.querySelector(".player-results-reference-delta"),this.bindPlayerEvents()}}bindPlayerEvents(){this.nameElem?.addEventListener("input",(t=>{this.player?.setName(o.nextEventID(),this.nameElem?.value||"")})),this.nameElem?.addEventListener("mousedown",(t=>{this.partyPicker.rootElem.setAttribute("draggable","false")})),this.nameElem?.addEventListener("mouseup",(t=>{this.partyPicker.rootElem.setAttribute("draggable","true")}));const t="Unnamed";this.nameElem?.addEventListener("focusout",(e=>{this.nameElem&&!this.nameElem.value&&(this.nameElem.value=t,this.player?.setName(o.nextEventID(),t))}));const e=(t,e)=>{if(null!=this.player){if(t.dataTransfer.dropEffect="move",t.dataTransfer.effectAllowed="all",this.player){var a=this.player.toProto(!0);t.dataTransfer.setData("text/plain",btoa(String.fromCharCode(...c.toBinary(a))))}this.raidPicker.setDragPlayer(this.player,this.raidIndex,e)}else t.preventDefault()},s=this.rootElem.querySelector(".player-edit"),r=this.rootElem.querySelector(".player-copy"),i=this.rootElem.querySelector(".player-delete");a.getOrCreateInstance(s),a.getOrCreateInstance(r);const n=a.getOrCreateInstance(i);this.iconElem.ondragstart=t=>{t.dataTransfer.setDragImage(this.rootElem,20,20),e(t,3)},s.onclick=t=>{new ne(this.player)},r.ondragstart=t=>{t.dataTransfer.setDragImage(this.rootElem,20,20),e(t,4)},i.onclick=t=>{n.hide(),this.setPlayer(o.nextEventID(),null,0)}}}class ne extends ft{constructor(t){super(document.body,"player-editor-modal",{closeButton:{fixed:!0},header:!1}),this.rootElem.id="playerEditorModal",this.body.insertAdjacentHTML("beforeend",'\n\t\t\t<div class="player-editor within-raid-sim"></div>\n\t\t');const e=this.rootElem.getElementsByClassName("player-editor")[0];Yt[t.spec](e,t)}}class le extends n{constructor(t,s){super(t,"new-player-picker-root"),e(this,"raidPicker"),this.raidPicker=s,m(h).forEach((t=>{if(t==h.ClassUnknown)return;const e=Zt.filter((e=>u[e.spec]==t));if(0==e.length)return;const s=document.createElement("div");s.classList.add("class-presets-container",`bg-${p(t)}-dampened`),this.rootElem.appendChild(s),e.forEach((t=>{const e=document.createElement("fragment");e.innerHTML=`\n\t\t\t\t\t<a\n\t\t\t\t\t\thref="javascript:void(0)"\n\t\t\t\t\t\trole="button"\n\t\t\t\t\t\tdraggable="true"\n\t\t\t\t\t\tdata-bs-toggle="tooltip"\n\t\t\t\t\t\tdata-bs-title="${t.tooltip}"\n\t\t\t\t\t\tdata-bs-html="true"\n\t\t\t\t\t>\n\t\t\t\t\t\t<img class="preset-picker-icon player-icon" src="${t.iconUrl}"/>\n\t\t\t\t\t</a>\n\t\t\t\t`;const r=e.children[0];s.appendChild(r),a.getOrCreateInstance(r),r.ondragstart=e=>{const a=o.nextEventID();o.freezeAllAndDo((()=>{const s=new Image;s.src=t.iconUrl,e.dataTransfer.setDragImage(s,30,30),e.dataTransfer.setData("text/plain",""),e.dataTransfer.dropEffect="copy";const r=new ut(t.spec,this.raidPicker.raid.sim);r.applySharedDefaults(a),r.setRace(a,t.defaultFactionRaces[this.raidPicker.getCurrentFaction()]),r.setTalentsString(a,t.talents.talentsString),r.setGlyphs(a,t.talents.glyphs||f.create()),r.setSpecOptions(a,t.specOptions),r.setConsumes(a,t.consumes),r.setName(a,t.defaultName),r.setProfession1(a,t.otherDefaults?.profession1||g.Engineering),r.setProfession2(a,t.otherDefaults?.profession2||g.Jewelcrafting),r.setDistanceFromTarget(a,t.otherDefaults?.distanceFromTarget||0),this.raidPicker.raid.sim.waitForInit().then((()=>{const e=Math.min(this.raidPicker.getCurrentPhase(),ae),s=t.defaultGear[this.raidPicker.getCurrentFaction()][e];r.setGear(a,this.raidPicker.raid.sim.db.lookupEquipmentSpec(s))})),this.raidPicker.setDragPlayer(r,ee,1)}))}}))}))}}class oe extends n{constructor(t,a){super(t,"raid-stats"),e(this,"categories");let s=[];Se.sections.forEach((t=>{const e=document.createElement("div");e.classList.add("raid-stats-section"),this.rootElem.appendChild(e),e.innerHTML=`\n\t\t\t\t<div class="raid-stats-section-header">\n\t\t\t\t\t<label class="raid-stats-section-label form-label">${t.label}</label>\n\t\t\t\t</div>\n\t\t\t\t<div class="raid-stats-section-content"></div>\n\t\t\t`;const r=e.getElementsByClassName("raid-stats-section-content")[0];t.categories.forEach((t=>{s.push(new ce(r,a,t))}))})),this.categories=s,a.changeEmitter.on((t=>this.categories.forEach((t=>t.update()))))}}class ce extends n{constructor(t,s,r){if(super(t,"raid-stats-category-root"),e(this,"raidSimUI"),e(this,"options"),e(this,"effects"),e(this,"counterElem"),e(this,"tooltipElem"),this.raidSimUI=s,this.options=r,this.rootElem.innerHTML=`\n\t\t\t<a href="javascript:void(0)" role="button" class="raid-stats-category">\n\t\t\t\t<span class="raid-stats-category-counter"></span>\n\t\t\t\t<span class="raid-stats-category-label">${r.label}</span>\n\t\t\t</a>\n\t\t`,this.counterElem=this.rootElem.querySelector(".raid-stats-category-counter"),this.tooltipElem=document.createElement("div"),this.tooltipElem.innerHTML=`\n\t\t\t<label class="raid-stats-category-label">${r.label}</label>\n\t\t`,this.effects=r.effects.map((t=>new de(this.tooltipElem,s,t))),1!=r.effects.length||r.effects[0].playerData?.class){const t=this.rootElem.querySelector(".raid-stats-category");a.getOrCreateInstance(t,{customClass:"raid-stats-category-tooltip",html:!0,placement:"right",title:this.tooltipElem})}}update(){this.effects.forEach((t=>t.update()));const t=A(this.effects.map((t=>t.count)));this.counterElem.textContent=String(t);const e=this.rootElem.querySelector(".raid-stats-category");0==t?e?.classList.remove("active"):e?.classList.add("active")}}class de extends n{constructor(t,a,s){if(super(t,"raid-stats-effect"),e(this,"raidSimUI"),e(this,"options"),e(this,"counterElem"),e(this,"curPlayers"),e(this,"count"),this.raidSimUI=a,this.options=s,this.curPlayers=[],this.count=0,this.rootElem.innerHTML=`\n\t\t\t<span class="raid-stats-effect-counter"></span>\n\t\t\t<img class="raid-stats-effect-icon"></img>\n\t\t\t<span class="raid-stats-effect-label">${s.label}</span>\n\t\t`,this.counterElem=this.rootElem.querySelector(".raid-stats-effect-counter"),this.options.playerData?.class){const t=this.rootElem.querySelector(".raid-stats-effect-label"),e=L(this.options.playerData.class);t.classList.add(e)}const r=this.rootElem.querySelector(".raid-stats-effect-icon");s.actionId?s.actionId.fill().then((t=>r.src=t.iconUrl)):r.remove()}update(){this.options.playerData&&(this.curPlayers=this.raidSimUI.getActivePlayers().filter((t=>this.options.playerData.condition(t))));const t=this.options.raidData&&this.options.raidData(this.raidSimUI.sim.raid);this.count=this.curPlayers.length+(t?1:0),this.counterElem.textContent=String(this.count),0==this.count?this.rootElem.classList.remove("active"):this.rootElem.classList.add("active")}}function pe(t,e){return e?!t:t}function me(t,e){return{class:t,condition:a=>a.isClass(t)&&(!e||e(a))}}function he(t,e,a,s){return{class:t,condition:r=>r.isClass(t)&&pe(Boolean(r.getTalents()[e]),a)&&(!s||s(r))}}function ue(t,e,a){return he(t,e,!1,a)}function fe(t,e,a){return he(t,e,!0,a)}function ge(t,e,a,s){return{class:u[t],condition:r=>r.isSpec(t)&&pe(Boolean(r.getTalents()[e]),a)&&(!s||s(r))}}function ye(t,e,a){return ge(t,e,!1,a)}function Ie(t){return e=>Boolean(e.getBuffs()[t])}const Se={sections:[{label:"Roles",categories:[{label:"Tanks",effects:[{label:"Tanks",playerData:{condition:t=>y(t.spec)}}]},{label:"Healers",effects:[{label:"Healers",playerData:{condition:t=>S(t.spec)}}]},{label:"Melee",effects:[{label:"Melee",playerData:{condition:t=>P(t.spec)}}]},{label:"Ranged",effects:[{label:"Ranged",playerData:{condition:t=>b(t.spec)}}]}]},{label:"Buffs",categories:[{label:"Bloodlust",effects:[{label:"Bloodlust",actionId:D.fromSpellId(2825),playerData:me(h.ClassShaman,(t=>t.getSpecOptions().bloodlust))}]},{label:"Stats",effects:[{label:"Improved Gift of the Wild",actionId:D.fromSpellId(17051),playerData:ue(h.ClassDruid,"improvedMarkOfTheWild")},{label:"Gift of the Wild",actionId:D.fromSpellId(48470),playerData:fe(h.ClassDruid,"improvedMarkOfTheWild")},{label:"Drums of the Wild",actionId:D.fromItemId(49634),raidData:Ie("drumsOfTheWild")}]},{label:"Stats %",effects:[{label:"Blessing of Kings",actionId:D.fromSpellId(25898),playerData:me(h.ClassPaladin)},{label:"Drums of Forgotten Kings",actionId:D.fromItemId(49633),raidData:Ie("drumsOfForgottenKings")},{label:"Blessing of Sanctuary",actionId:D.fromSpellId(25899),playerData:me(h.ClassPaladin)}]},{label:"Armor",effects:[{label:"Improved Devotion Aura",actionId:D.fromSpellId(20140),playerData:ue(h.ClassPaladin,"improvedDevotionAura",(t=>t.getSpecOptions().aura==O.DevotionAura))},{label:"Devotion Aura",actionId:D.fromSpellId(48942),playerData:fe(h.ClassPaladin,"improvedDevotionAura",(t=>t.getSpecOptions().aura==O.DevotionAura))},{label:"Improved Stoneskin Totem",actionId:D.fromSpellId(16293),playerData:ue(h.ClassShaman,"guardianTotems",(t=>t.getSpecOptions().totems?.earth==U.StoneskinTotem))},{label:"Stoneskin Totem",actionId:D.fromSpellId(58753),playerData:fe(h.ClassShaman,"guardianTotems",(t=>t.getSpecOptions().totems?.earth==U.StoneskinTotem))},{label:"Scroll of Protection",actionId:D.fromItemId(43468),raidData:Ie("scrollOfProtection")}]},{label:"Stamina",effects:[{label:"Improved Power Word Fortitude",actionId:D.fromSpellId(14767),playerData:ue(h.ClassPriest,"improvedPowerWordFortitude")},{label:"Power Word Fortitude",actionId:D.fromSpellId(48161),playerData:fe(h.ClassPriest,"improvedPowerWordFortitude")},{label:"Scroll of Stamina",actionId:D.fromItemId(37094),raidData:Ie("scrollOfStamina")}]},{label:"Str + Agi",effects:[{label:"Improved Strength of Earth Totem",actionId:D.fromSpellId(52456),playerData:ue(h.ClassShaman,"enhancingTotems",(t=>t.getSpecOptions().totems?.earth==U.StrengthOfEarthTotem))},{label:"Strength of Earth Totem",actionId:D.fromSpellId(58643),playerData:fe(h.ClassShaman,"enhancingTotems",(t=>t.getSpecOptions().totems?.earth==U.StrengthOfEarthTotem))},{label:"Horn of Winter",actionId:D.fromSpellId(57623),playerData:me(h.ClassDeathknight)},{label:"Scroll of Strength",actionId:D.fromItemId(43466),raidData:Ie("scrollOfStrength")},{label:"Scroll of Agility",actionId:D.fromItemId(43464),raidData:Ie("scrollOfAgility")}]},{label:"Intellect",effects:[{label:"Arcane Brilliance",actionId:D.fromSpellId(43002),playerData:me(h.ClassMage)},{label:"Improved Fel Intelligence",actionId:D.fromSpellId(54038),playerData:ue(h.ClassWarlock,"improvedFelhunter",(t=>t.getSpecOptions().summon==W.Felhunter))},{label:"Fel Intelligence",actionId:D.fromSpellId(57567),playerData:fe(h.ClassWarlock,"improvedFelhunter",(t=>t.getSpecOptions().summon==W.Felhunter))},{label:"Scroll of Intellect",actionId:D.fromItemId(37092),raidData:Ie("scrollOfIntellect")}]},{label:"Spirit",effects:[{label:"Divine Spirit",actionId:D.fromSpellId(48073),playerData:me(h.ClassPriest)},{label:"Improved Fel Intelligence",actionId:D.fromSpellId(54038),playerData:ue(h.ClassWarlock,"improvedFelhunter",(t=>t.getSpecOptions().summon==W.Felhunter))},{label:"Fel Intelligence",actionId:D.fromSpellId(57567),playerData:fe(h.ClassWarlock,"improvedFelhunter",(t=>t.getSpecOptions().summon==W.Felhunter))},{label:"Scroll of Spirit",actionId:D.fromItemId(37098),raidData:Ie("scrollOfSpirit")}]},{label:"Atk Pwr",effects:[{label:"Improved Blessing of Might",actionId:D.fromSpellId(20045),playerData:me(h.ClassPaladin)},{label:"Blessing of Might",actionId:D.fromSpellId(48934),playerData:me(h.ClassPaladin)},{label:"Improved Battle Shout",actionId:D.fromSpellId(12861),playerData:ue(h.ClassWarrior,"commandingPresence",(t=>t.getSpecOptions().shout==F.WarriorShoutBattle))},{label:"Battle Shout",actionId:D.fromSpellId(47436),playerData:fe(h.ClassWarrior,"commandingPresence",(t=>t.getSpecOptions().shout==F.WarriorShoutBattle))}]},{label:"Atk Pwr %",effects:[{label:"Abomination's Might",actionId:D.fromSpellId(53138),playerData:ue(h.ClassDeathknight,"abominationsMight")},{label:"Unleashed Rage",actionId:D.fromSpellId(30809),playerData:ue(h.ClassShaman,"unleashedRage")},{label:"Trueshot Aura",actionId:D.fromSpellId(19506),playerData:ue(h.ClassHunter,"trueshotAura")}]},{label:"Damage %",effects:[{label:"Sanctified Retribution",actionId:D.fromSpellId(31869),playerData:ue(h.ClassPaladin,"sanctifiedRetribution")},{label:"Arcane Empowerment",actionId:D.fromSpellId(31583),playerData:ue(h.ClassMage,"arcaneEmpowerment")},{label:"Ferocious Inspiration",actionId:D.fromSpellId(34460),playerData:ue(h.ClassHunter,"ferociousInspiration")}]},{label:"Mit %",effects:[{label:"Renewed Hope",actionId:D.fromSpellId(57472),playerData:ue(h.ClassPriest,"renewedHope")},{label:"Blessing Of Sanctuary",actionId:D.fromSpellId(25899),playerData:me(h.ClassPaladin)},{label:"Vigilance",actionId:D.fromSpellId(50720),playerData:ue(h.ClassWarrior,"vigilance")}]},{label:"Haste %",effects:[{label:"Swift Retribution",actionId:D.fromSpellId(53648),playerData:ue(h.ClassPaladin,"swiftRetribution")},{label:"Improved Moonkin Form",actionId:D.fromSpellId(48396),playerData:ue(h.ClassDruid,"improvedMoonkinForm")}]},{label:"MP5",effects:[{label:"Improved Blessing of Wisdom",actionId:D.fromSpellId(20245),playerData:ue(h.ClassPaladin,"improvedBlessingOfWisdom")},{label:"Blessing of Wisdom",actionId:D.fromSpellId(48938),playerData:fe(h.ClassPaladin,"improvedBlessingOfWisdom")},{label:"Improved Mana Spring Totem",actionId:D.fromSpellId(16206),playerData:ue(h.ClassShaman,"restorativeTotems",(t=>t.getSpecOptions().totems?.water==x.ManaSpringTotem))},{label:"Mana Spring Totem",actionId:D.fromSpellId(58774),playerData:fe(h.ClassShaman,"restorativeTotems",(t=>t.getSpecOptions().totems?.water==x.ManaSpringTotem))}]},{label:"Melee Crit",effects:[{label:"Leader of the Pack",actionId:D.fromSpellId(17007),playerData:ue(h.ClassDruid,"leaderOfThePack")},{label:"Rampage",actionId:D.fromSpellId(29801),playerData:ue(h.ClassWarrior,"rampage")}]},{label:"Melee Haste",effects:[{label:"Improved Icy Talons",actionId:D.fromSpellId(55610),playerData:ue(h.ClassDeathknight,"improvedIcyTalons")},{label:"Improved Windfury Totem",actionId:D.fromSpellId(29193),playerData:ue(h.ClassShaman,"improvedWindfuryTotem",(t=>t.getSpecOptions().totems?.air==k.WindfuryTotem))},{label:"Windfury Totem",actionId:D.fromSpellId(65990),playerData:fe(h.ClassShaman,"improvedWindfuryTotem",(t=>t.getSpecOptions().totems?.air==k.WindfuryTotem))}]},{label:"Spell Power",effects:[{label:"Demonic Pact",actionId:D.fromSpellId(47240),playerData:ue(h.ClassWarlock,"demonicPact")},{label:"Totem of Wrath",actionId:D.fromSpellId(57722),playerData:ue(h.ClassShaman,"totemOfWrath",(t=>t.getSpecOptions().totems?.fire==E.TotemOfWrath))},{label:"Flametongue Totem",actionId:D.fromSpellId(58656),playerData:me(h.ClassShaman,(t=>t.getSpecOptions().totems?.fire==E.FlametongueTotem))}]},{label:"Spell Crit",effects:[{label:"Moonkin Form",actionId:D.fromSpellId(24907),playerData:ye(s.SpecBalanceDruid,"moonkinForm")},{label:"Elemental Oath",actionId:D.fromSpellId(51470),playerData:ue(h.ClassShaman,"elementalOath")}]},{label:"Spell Haste",effects:[{label:"Wrath of Air Totem",actionId:D.fromSpellId(3738),playerData:me(h.ClassShaman,(t=>t.getSpecOptions().totems?.air==k.WrathOfAirTotem))}]},{label:"Health",effects:[{label:"Improved Commanding Shout",actionId:D.fromSpellId(12861),playerData:ue(h.ClassWarrior,"commandingPresence",(t=>t.getSpecOptions().shout==F.WarriorShoutCommanding))},{label:"Commanding Shout",actionId:D.fromSpellId(47440),playerData:fe(h.ClassWarrior,"commandingPresence",(t=>t.getSpecOptions().shout==F.WarriorShoutCommanding))},{label:"Improved Imp",actionId:D.fromSpellId(18696),playerData:ue(h.ClassWarlock,"improvedImp",(t=>t.getSpecOptions().summon==W.Imp))},{label:"Blood Pact",actionId:D.fromSpellId(47982),playerData:fe(h.ClassWarlock,"improvedImp",(t=>t.getSpecOptions().summon==W.Imp))}]},{label:"Replenishment",effects:[{label:"Vampiric Touch",actionId:D.fromSpellId(48160),playerData:ye(s.SpecShadowPriest,"vampiricTouch")},{label:"Judgements of the Wise",actionId:D.fromSpellId(31878),playerData:ye(s.SpecRetributionPaladin,"judgementsOfTheWise")},{label:"Hunting Party",actionId:D.fromSpellId(53292),playerData:ye(s.SpecHunter,"huntingParty")},{label:"Improved Soul Leech",actionId:D.fromSpellId(54118),playerData:ye(s.SpecWarlock,"improvedSoulLeech")},{label:"Enduring Winter",actionId:D.fromSpellId(44561),playerData:ye(s.SpecMage,"enduringWinter")}]}]},{label:"External Buffs",categories:[{label:"Innervate",effects:[{label:"Innervate",actionId:D.fromSpellId(29166),playerData:me(h.ClassDruid)}]},{label:"Power Infusion",effects:[{label:"Power Infusion",actionId:D.fromSpellId(10060),playerData:ue(h.ClassPriest,"powerInfusion")}]},{label:"Focus Magic",effects:[{label:"Focus Magic",actionId:D.fromSpellId(54648),playerData:ue(h.ClassMage,"focusMagic")}]},{label:"Tricks of the Trade",effects:[{label:"Tricks of the Trade",actionId:D.fromSpellId(57933),playerData:me(h.ClassRogue)}]},{label:"Unholy Frenzy",effects:[{label:"Unholy Frenzy",actionId:D.fromSpellId(49016),playerData:ue(h.ClassDeathknight,"hysteria")}]},{label:"Pain Suppression",effects:[{label:"Pain Suppression",actionId:D.fromSpellId(33206),playerData:ue(h.ClassPriest,"painSuppression")}]},{label:"Divine Guardian",effects:[{label:"Divine Guardian",actionId:D.fromSpellId(53530),playerData:ue(h.ClassPaladin,"divineGuardian")}]}]},{label:"DPS Debuffs",categories:[{label:"Major ArP",effects:[{label:"Sunder Armor",actionId:D.fromSpellId(47467),playerData:me(h.ClassWarrior,(t=>t.isSpec(s.SpecProtectionWarrior)||t.getRotation().sunderArmor==C.SunderArmorMaintain))},{label:"Expose Armor",actionId:D.fromSpellId(8647),playerData:me(h.ClassRogue,(t=>t.getRotation().exposeArmorFrequency==v.Maintain))},{label:"Acid Spit",actionId:D.fromSpellId(55754),playerData:me(h.ClassHunter,(t=>t.getSpecOptions().petType==T.Worm))}]},{label:"Minor ArP",effects:[{label:"Faerie Fire",actionId:D.fromSpellId(770),playerData:me(h.ClassDruid,(t=>t.spec==s.SpecFeralTankDruid||t.spec!=s.SpecRestorationDruid&&t.getRotation().maintainFaerieFire))},{label:"Curse of Weakness",actionId:D.fromSpellId(50511),playerData:me(h.ClassWarlock,(t=>t.getRotation().curse==w.Weakness))},{label:"Sting",actionId:D.fromSpellId(56631),playerData:me(h.ClassHunter,(t=>t.getSpecOptions().petType==T.Wasp))},{label:"Spore Cloud",actionId:D.fromSpellId(53598),playerData:me(h.ClassHunter,(t=>t.getSpecOptions().petType==T.Bat))}]},{label:"Phys Vuln",effects:[{label:"Blood Frenzy",actionId:D.fromSpellId(29859),playerData:ue(h.ClassWarrior,"bloodFrenzy")},{label:"Savage Combat",actionId:D.fromSpellId(58413),playerData:ue(h.ClassRogue,"savageCombat")}]},{label:"Bleed",effects:[{label:"Mangle",actionId:D.fromSpellId(16862),playerData:me(h.ClassDruid,(t=>[s.SpecFeralDruid,s.SpecFeralTankDruid].includes(t.spec)))},{label:"Trauma",actionId:D.fromSpellId(46855),playerData:ue(h.ClassWarrior,"trauma")},{label:"Stampede",actionId:D.fromSpellId(57393),playerData:me(h.ClassHunter,(t=>t.getSpecOptions().petType==T.Rhino))}]},{label:"Crit",effects:[{label:"Totem of Wrath",actionId:D.fromSpellId(30706),playerData:ue(h.ClassShaman,"totemOfWrath",(t=>t.getSpecOptions().totems?.fire==E.TotemOfWrath))},{label:"Heart of the Crusader",actionId:D.fromSpellId(20337),playerData:ue(h.ClassPaladin,"heartOfTheCrusader",(t=>[s.SpecRetributionPaladin,s.SpecProtectionPaladin].includes(t.spec)))},{label:"Master Poisoner",actionId:D.fromSpellId(58410),playerData:ue(h.ClassRogue,"masterPoisoner")}]},{label:"Spell Crit",effects:[{label:"Improved Shadow Bolt",actionId:D.fromSpellId(17803),playerData:ue(h.ClassWarlock,"improvedShadowBolt")},{label:"Improved Scorch",actionId:D.fromSpellId(12873),playerData:ue(h.ClassMage,"improvedScorch",(t=>1==t.getTalentTree()&&t.getRotation().maintainImprovedScorch))},{label:"Winter's Chill",actionId:D.fromSpellId(28593),playerData:ue(h.ClassMage,"wintersChill",(t=>2==t.getTalentTree()))}]},{label:"Spell Hit",effects:[{label:"Misery",actionId:D.fromSpellId(33198),playerData:ye(s.SpecShadowPriest,"misery")},{label:"Improved Faerie Fire",actionId:D.fromSpellId(33602),playerData:ye(s.SpecBalanceDruid,"improvedFaerieFire")}]},{label:"Spell Dmg",effects:[{label:"Ebon Plaguebringer",actionId:D.fromSpellId(51161),playerData:ue(h.ClassDeathknight,"ebonPlaguebringer")},{label:"Earth and Moon",actionId:D.fromSpellId(48511),playerData:ye(s.SpecBalanceDruid,"earthAndMoon")},{label:"Curse of Elements",actionId:D.fromSpellId(47865),playerData:me(h.ClassWarlock,(t=>t.getRotation().curse==w.Elements))}]}]},{label:"Mitigation Debuffs",categories:[{label:"Atk Pwr",effects:[{label:"Vindication",actionId:D.fromSpellId(26016),playerData:ue(h.ClassPaladin,"vindication",(t=>[s.SpecRetributionPaladin,s.SpecProtectionPaladin].includes(t.spec)))},{label:"Improved Demoralizing Shout",actionId:D.fromSpellId(12879),playerData:ue(h.ClassWarrior,"improvedDemoralizingShout",(t=>t.spec==s.SpecWarrior&&t.getRotation().maintainDemoShout||t.spec==s.SpecProtectionWarrior&&0!=t.getRotation().demoShoutChoice))},{label:"Demoralizing Shout",actionId:D.fromSpellId(47437),playerData:fe(h.ClassWarrior,"improvedDemoralizingShout",(t=>t.spec==s.SpecWarrior&&t.getRotation().maintainDemoShout||t.spec==s.SpecProtectionWarrior&&0!=t.getRotation().demoShoutChoice))},{label:"Improved Demoralizing Roar",actionId:D.fromSpellId(16862),playerData:ye(s.SpecFeralTankDruid,"feralAggression",(t=>t.getRotation().maintainDemoralizingRoar))},{label:"Demoralizing Roar",actionId:D.fromSpellId(48560),playerData:(Pe=s.SpecFeralTankDruid,be="feralAggression",De=t=>t.getRotation().maintainDemoralizingRoar,ge(Pe,be,!0,De))},{label:"Improved Curse of Weakness",actionId:D.fromSpellId(18180),playerData:ue(h.ClassWarlock,"improvedCurseOfWeakness",(t=>t.getRotation().curse==w.Weakness))},{label:"Curse of Weakness",actionId:D.fromSpellId(50511),playerData:ue(h.ClassWarlock,"improvedCurseOfWeakness",(t=>t.getRotation().curse==w.Weakness))},{label:"Demoralizing Screech",actionId:D.fromSpellId(55487),playerData:me(h.ClassHunter,(t=>t.getSpecOptions().petType==T.CarrionBird))}]},{label:"Atk Speed",effects:[{label:"Improved Thunder Clap",actionId:D.fromSpellId(12666),playerData:ue(h.ClassWarrior,"improvedThunderClap",(t=>t.spec==s.SpecWarrior&&t.getRotation().maintainThunderClap||t.spec==s.SpecProtectionWarrior&&0!=t.getRotation().thunderClapChoice))},{label:"Thunder Clap",actionId:D.fromSpellId(47502),playerData:fe(h.ClassWarrior,"improvedThunderClap",(t=>t.spec==s.SpecWarrior&&t.getRotation().maintainThunderClap||t.spec==s.SpecProtectionWarrior&&0!=t.getRotation().thunderClapChoice))},{label:"Improved Frost Fever",actionId:D.fromSpellId(51456),playerData:ue(h.ClassDeathknight,"improvedIcyTouch")},{label:"Frost Fever",actionId:D.fromSpellId(51456),playerData:fe(h.ClassDeathknight,"improvedIcyTouch")},{label:"Judgements of the Just",actionId:D.fromSpellId(53696),playerData:ue(h.ClassPaladin,"judgementsOfTheJust")},{label:"Infected Wounds",actionId:D.fromSpellId(48485),playerData:ue(h.ClassDruid,"infectedWounds",(t=>[s.SpecFeralDruid,s.SpecFeralTankDruid].includes(t.spec)))}]},{label:"Miss",effects:[{label:"Insect Swarm",actionId:D.fromSpellId(65855),playerData:ye(s.SpecBalanceDruid,"insectSwarm")},{label:"Scorpid Sting",actionId:D.fromSpellId(3043),playerData:me(h.ClassHunter,(t=>t.getRotation().sting==R.ScorpidSting))}]}]}]};var Pe,be,De;class Ee extends gt{constructor(t,a){super(t,a,{identifier:"raid-tab",title:"Raid"}),e(this,"simUI"),e(this,"leftPanel"),e(this,"rightPanel"),this.simUI=a,this.rootElem.classList.add("active","show"),this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("raid-tab-left","tab-panel-left"),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("raid-tab-right","tab-panel-right"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent()}buildTabContent(){this.simUI.raidPicker=new se(this.leftPanel,this.simUI),new oe(this.leftPanel,this.simUI);const t=new yt(this.rightPanel,this.simUI,{label:"Raid",header:{title:"Saved Raid Groups"},storageKey:this.simUI.getSavedRaidStorageKey(),getData:t=>B.create({raid:this.simUI.sim.raid.toProto(),blessings:this.simUI.blessingsPicker.getAssignments(),faction:this.simUI.sim.getFaction(),phase:this.simUI.sim.getPhase()}),setData:(t,e,a)=>{o.freezeAllAndDo((()=>{this.simUI.sim.raid.fromProto(t,a.raid||M.create()),this.simUI.blessingsPicker.setAssignments(t,a.blessings||H.create()),a.faction&&this.simUI.sim.setFaction(t,a.faction),a.phase&&this.simUI.sim.setPhase(t,a.phase)}))},changeEmitters:[this.simUI.changeEmitter,this.simUI.sim.changeEmitter],equals:(t,e)=>B.equals(t,e),toJson:t=>B.toJson(t),fromJson:t=>B.fromJson(t)});this.simUI.sim.waitForInit().then((()=>{t.loadUserData()}))}}class ke extends ${constructor(t,a,s,r){super(t,"raid-target-picker-root",s,r),e(this,"config"),e(this,"raid"),e(this,"curPlayer"),e(this,"curUnitReference"),e(this,"currentOptions"),e(this,"buttonElem"),e(this,"dropdownElem"),this.rootElem.classList.add("dropdown"),this.config=r,this.raid=a,this.curPlayer=this.raid.getPlayerFromUnitReference(r.getValue(s)),this.curUnitReference=this.getInputValue(),this.rootElem.innerHTML='\n\t\t\t<a\n\t\t\t\tclass="raid-target-picker-button"\n\t\t\t\thref="javascript:void(0)"\n\t\t\t\trole="button"\n\t\t\t\tdata-bs-toggle="dropdown"\n\t\t\t></a>\n\t\t\t<div class="dropdown-menu"></div>\n    ',this.buttonElem=this.rootElem.querySelector(".raid-target-picker-button"),this.dropdownElem=this.rootElem.querySelector(".dropdown-menu"),this.buttonElem.addEventListener("click",(t=>t.preventDefault())),this.currentOptions=[],this.updateOptions(o.nextEventID()),r.compChangeEmitter.on((t=>this.updateOptions(t))),this.init()}makeTargetOptions(){return[{player:null,isDropdown:!0},...this.raid.getPlayers().filter((t=>null!=t)).map((t=>({player:t,isDropdown:!0})))]}updateOptions(t){this.currentOptions=this.makeTargetOptions(),this.dropdownElem.innerHTML="",this.currentOptions.forEach((t=>this.dropdownElem.appendChild(this.makeOption(t))));const e=this.curUnitReference;this.curUnitReference=this.getInputValue(),j.equals(e,this.curUnitReference)?this.setInputValue(this.curUnitReference):this.inputChanged(t)}makeOption(t){const e=ke.makeOptionElem(t);return e.addEventListener("click",(e=>{e.preventDefault(),this.curPlayer=t.player,this.curUnitReference=this.getInputValue(),this.inputChanged(o.nextEventID())})),e}getInputElem(){return this.buttonElem}getInputValue(){return this.curPlayer?this.curPlayer.makeUnitReference():V()}setInputValue(t){this.curUnitReference=j.clone(t),this.curPlayer=this.raid.getPlayerFromUnitReference(this.curUnitReference);const e=this.currentOptions.find((t=>t.player==this.curPlayer));e&&(this.buttonElem.innerHTML=ke.makeOptionElem({player:e.player}).outerHTML)}static makeOptionElem(t){const e=t.player?p(t.player.getClass()):"";let a=document.createElement("fragment");return a.innerHTML=`\n\t\t\t<div class="player ${e?`bg-${e}-dampened`:""}">\n\t\t\t\t<div class="player-label">\n\t\t\t\t\t${t.player?`<img class="player-icon" src="${t.player.getSpecIcon()}" draggable="false"/>`:""}\n\t\t\t\t\t<div class="player-details">\n\t\t\t\t\t\t<span class="player-name ${e?`text-${e}`:""}">\n\t\t\t\t\t\t\t${t.player?t.player.getName():"Unassigned"}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`,t.isDropdown&&(a.innerHTML=`\n\t\t\t\t<a class="dropdown-option" href="javascript:void(0) role="button">${a.innerHTML}</a>\n\t\t\t`),a.children[0]}}class Ce extends n{constructor(t,a){super(t,"assignments-picker-root"),e(this,"raidSimUI"),e(this,"changeEmitter",new o),e(this,"innervatesPicker"),e(this,"powerInfusionsPicker"),e(this,"tricksOfTheTradesPicker"),e(this,"unholyFrenzyPicker"),e(this,"focusMagicsPicker"),this.raidSimUI=a,this.innervatesPicker=new Te(this.rootElem,a),this.powerInfusionsPicker=new we(this.rootElem,a),this.tricksOfTheTradesPicker=new Re(this.rootElem,a),this.unholyFrenzyPicker=new Oe(this.rootElem,a),this.focusMagicsPicker=new Ue(this.rootElem,a)}}class ve extends n{constructor(t,a){super(t,"assigned-buff-picker-root"),e(this,"raidSimUI"),e(this,"changeEmitter",new o),e(this,"playersContainer"),e(this,"targetPickers"),this.raidSimUI=a,this.targetPickers=[],this.playersContainer=document.createElement("div"),this.playersContainer.classList.add("assigned-buff-container"),this.rootElem.appendChild(this.playersContainer),this.raidSimUI.changeEmitter.on((t=>this.update())),this.update()}update(){this.playersContainer.innerHTML=`\n\t\t\t<label class="assignmented-buff-label form-label">${this.getTitle()}</label>\n\t\t`;const t=this.getSourcePlayers();0==t.length?this.rootElem.classList.add("hide"):this.rootElem.classList.remove("hide"),this.targetPickers=t.map(((t,e)=>{const a=document.createElement("div");a.classList.add("assigned-buff-player","input-inline"),this.playersContainer.appendChild(a);let s=document.createElement("div");s.classList.add("raid-target-picker-root"),s.appendChild(ke.makeOptionElem({player:t,isDropdown:!1})),a.appendChild(s);const r=document.createElement("i");r.classList.add("assigned-buff-arrow","fa","fa-arrow-right"),a.appendChild(r);const i=new ke(a,this.raidSimUI.sim.raid,t,{extraCssClasses:["assigned-buff-target-picker"],noTargetLabel:"Unassigned",compChangeEmitter:this.raidSimUI.sim.raid.compChangeEmitter,changedEvent:t=>t.specOptionsChangeEmitter,getValue:t=>this.getPlayerValue(t),setValue:(t,e,a)=>this.setPlayerValue(t,e,a)}),n={player:t,targetPicker:i,targetPlayer:this.raidSimUI.sim.raid.getPlayerFromUnitReference(i.getInputValue())};return i.changeEmitter.on((t=>{n.targetPlayer=this.raidSimUI.sim.raid.getPlayerFromUnitReference(i.getInputValue())})),n}))}}class Te extends ve{getTitle(){return"Innervate"}getSourcePlayers(){return this.raidSimUI.getActivePlayers().filter((t=>t.isClass(h.ClassDruid)))}getPlayerValue(t){return t.getSpecOptions().innervateTarget||V()}setPlayerValue(t,e,a){const s=e.getSpecOptions();s.innervateTarget=a,e.setSpecOptions(t,s)}}class we extends ve{getTitle(){return"Power Infusion"}getSourcePlayers(){return this.raidSimUI.getActivePlayers().filter((t=>t.isClass(h.ClassPriest)&&t.getTalents().powerInfusion))}getPlayerValue(t){return t.getSpecOptions().powerInfusionTarget||V()}setPlayerValue(t,e,a){const s=e.getSpecOptions();s.powerInfusionTarget=a,e.setSpecOptions(t,s)}}class Re extends ve{getTitle(){return"Tricks of the Trade"}getSourcePlayers(){return this.raidSimUI.getActivePlayers().filter((t=>t.isClass(h.ClassRogue)))}getPlayerValue(t){return t.getSpecOptions().tricksOfTheTradeTarget||V()}setPlayerValue(t,e,a){const s=e.getSpecOptions();s.tricksOfTheTradeTarget=a,e.setSpecOptions(t,s)}}class Oe extends ve{getTitle(){return"Unholy Frenzy"}getSourcePlayers(){return this.raidSimUI.getActivePlayers().filter((t=>t.isClass(h.ClassDeathknight)&&t.getTalents().hysteria))}getPlayerValue(t){return t.getSpecOptions().unholyFrenzyTarget||V()}setPlayerValue(t,e,a){const s=e.getSpecOptions();s.unholyFrenzyTarget=a,e.setSpecOptions(t,s)}}class Ue extends ve{getTitle(){return"Focus Magic"}getSourcePlayers(){return this.raidSimUI.getActivePlayers().filter((t=>t.isClass(h.ClassMage)))}getPlayerValue(t){return t.getSpecOptions().focusMagicTarget||V()}setPlayerValue(t,e,a){const s=e.getSpecOptions();s.focusMagicTarget=a,e.setSpecOptions(t,s)}}class We extends n{constructor(t,a){super(t,"blessings-picker-root"),e(this,"simUI"),e(this,"changeEmitter",new o),e(this,"pickers",[]),e(this,"assignments"),this.simUI=a,this.assignments=H.clone(q(4));const s=r.filter((t=>te.includes(t))).filter((t=>!St.includes(t))),i=[...Array(4).keys()];s.map((t=>{const e=document.createElement("div");e.classList.add("blessings-picker-row"),this.rootElem.appendChild(e),e.append(this.buildSpecIcon(t));const a=document.createElement("div");return a.classList.add("blessings-picker-container"),e.appendChild(a),i.forEach((e=>{this.pickers[e]||this.pickers.push([]);const s=new It(a,this,{extraCssClasses:["blessing-picker"],numColumns:1,values:[{color:z[h.ClassPaladin],value:N.BlessingUnknown},{actionId:D.fromSpellId(25898),value:N.BlessingOfKings},{actionId:D.fromSpellId(48934),value:N.BlessingOfMight},{actionId:D.fromSpellId(48938),value:N.BlessingOfWisdom},{actionId:D.fromSpellId(25899),value:N.BlessingOfSanctuary}],equals:(t,e)=>t==e,zeroValue:N.BlessingUnknown,enableWhen:t=>{const a=Math.min(this.simUI.getClassCount(h.ClassPaladin),4);return e<a},changedEvent:t=>t.changeEmitter,getValue:a=>a.assignments.paladins[e]?.blessings[t]||N.BlessingUnknown,setValue:(a,s,r)=>{s.assignments.paladins[e].blessings[t]!=r&&(s.assignments.paladins[e].blessings[t]=r,this.changeEmitter.emit(a))}});this.pickers[e].push(s)})),e})),this.updatePickers(),this.simUI.compChangeEmitter.on((t=>this.updatePickers()))}updatePickers(){for(let t=0;t<4;t++)this.pickers[t].forEach((t=>t.update()))}buildSpecIcon(t){let e=document.createElement("fragment");e.innerHTML=`\n\t\t\t<div class="blessings-picker-spec">\n\t\t\t\t<img\n\t\t\t\t\tsrc="${J[t]}"\n\t\t\t\t\tclass="blessings-spec-icon"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t`;const s=e.querySelector(".blessings-spec-icon");return a.getOrCreateInstance(s,{title:G[t]}),e.children[0]}getAssignments(){return H.clone(this.assignments)}setAssignments(t,e){this.assignments=H.clone(e),this.changeEmitter.emit(t)}}class Fe extends n{constructor(t,a){super(t,"tanks-picker-root"),e(this,"raidSimUI"),this.raidSimUI=a;const s=this.raidSimUI.sim.raid;for(let e=0;e<4;e++){const t=document.createElement("div");t.classList.add("tank-picker-row","input-inline"),this.rootElem.appendChild(t);const a=document.createElement("label");a.textContent=0==e?"Main Tank":`Tank ${e+1}`,a.classList.add("tank-picker-label","form-label"),t.appendChild(a),new ke(t,s,s,{extraCssClasses:["tank-picker"],noTargetLabel:"Unassigned",compChangeEmitter:s.compChangeEmitter,changedEvent:t=>t.tanksChangeEmitter,getValue:t=>t.getTanks()[e]||V(),setValue:(t,a,s)=>{const r=a.getTanks();for(let i=0;i<e;i++)r[i]||r.push(V());r[e]=s,a.setTanks(t,r)}})}}}class xe extends gt{constructor(t,a){super(t,a,{identifier:"raid-settings-tab",title:"Settings"}),e(this,"simUI"),e(this,"leftPanel"),e(this,"rightPanel"),e(this,"column1",this.buildColumn(1,"raid-settings-col")),e(this,"column2",this.buildColumn(2,"raid-settings-col")),e(this,"column3",this.buildColumn(3,"raid-settings-col")),this.simUI=a,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("raid-settings-tab-left","tab-panel-left"),this.leftPanel.appendChild(this.column1),this.leftPanel.appendChild(this.column2),this.leftPanel.appendChild(this.column3),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("raid-settings-tab-right","tab-panel-right","within-raid-sim-hide"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent()}buildTabContent(){this.buildEncounterSettings(),this.buildConsumesSettings(),this.buildOtherSettings(),this.buildTankSettings(),this.buildAssignmentSettings(),this.buildBlessingsPicker(),this.buildSavedDataPickers()}buildEncounterSettings(){const t=new Pt(this.column1,"encounter-settings",{header:{title:"Encounter"}});new bt(t.bodyElement,this.simUI.sim.encounter,{showExecuteProportion:!0},this.simUI)}buildConsumesSettings(){const t=new Pt(this.column1,"consumes-settings",{header:{title:"Consumables"}});let e=document.createElement("div");e.classList.add("consumes-container"),t.bodyElement.appendChild(e),this.makeBooleanRaidIconBuffInput(e,D.fromItemId(37094),"scrollOfStamina"),this.makeBooleanRaidIconBuffInput(e,D.fromItemId(43466),"scrollOfStrength"),this.makeBooleanRaidIconBuffInput(e,D.fromItemId(43464),"scrollOfAgility"),this.makeBooleanRaidIconBuffInput(e,D.fromItemId(37092),"scrollOfIntellect"),this.makeBooleanRaidIconBuffInput(e,D.fromItemId(37098),"scrollOfSpirit"),this.makeBooleanRaidIconBuffInput(e,D.fromItemId(43468),"scrollOfProtection"),this.makeBooleanRaidIconBuffInput(e,D.fromItemId(49633),"drumsOfForgottenKings"),this.makeBooleanRaidIconBuffInput(e,D.fromItemId(49634),"drumsOfTheWild")}buildOtherSettings(){}buildTankSettings(){const t=new Pt(this.column2,"tanks-settings",{header:{title:"Tanks"}});new Fe(t.bodyElement,this.simUI)}buildAssignmentSettings(){const t=new Pt(this.column2,"assignments-settings",{header:{title:"External Buffs"}});new Ce(t.bodyElement,this.simUI)}buildBlessingsPicker(){const t=new Pt(this.column3,"blessings-settings",{header:{title:"Blessings",tooltip:Dt}});this.simUI.blessingsPicker=new We(t.bodyElement,this.simUI),this.simUI.blessingsPicker.changeEmitter.on((t=>this.simUI.changeEmitter.emit(t)))}buildSavedDataPickers(){const t=new yt(this.rightPanel,this.simUI.sim.encounter,{label:"Encounter",header:{title:"Saved Encounters"},storageKey:this.simUI.getSavedEncounterStorageKey(),getData:t=>K.create({encounter:t.toProto()}),setData:(t,e,a)=>e.fromProto(t,a.encounter),changeEmitters:[this.simUI.sim.encounter.changeEmitter],equals:(t,e)=>K.equals(t,e),toJson:t=>K.toJson(t),fromJson:t=>K.fromJson(t)});this.simUI.sim.waitForInit().then((()=>{t.loadUserData()}))}makeBooleanRaidIconBuffInput(t,e,a){const s=this.simUI.sim.raid;return new Et(t,s,{id:e,states:2,changedEvent:t=>t.buffsChangeEmitter,getValue:t=>t.getBuffs()[a],setValue:(t,e,s)=>{const r=e.getBuffs();r[a]=s,e.setBuffs(t,r)}})}}class Ae extends kt{constructor(t,a){super(t,a,"JSON Import",!0),e(this,"simUI"),this.simUI=a,this.descriptionElem.innerHTML="\n\t\t\t<p>\n\t\t\t\tImport settings from a JSON text file, which can be created using the JSON Export feature of this site.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tTo import, paste the JSON text below and click, 'Import'.\n\t\t\t</p>\n\t\t"}onImport(t){const e=X.fromJsonString(t,{ignoreUnknownFields:!0});this.simUI.fromProto(o.nextEventID(),e),this.close()}}class Le extends Ct{constructor(t,a){super(t,a,"JSON Export",!0),e(this,"simUI"),this.simUI=a,this.init()}getData(){return JSON.stringify(X.toJson(this.simUI.toProto()),null,2)}}class Be extends kt{constructor(t,a){super(t,a,"WCL Import",!1),e(this,"queryCounter",0),e(this,"simUI"),e(this,"token",""),this.simUI=a,this.textElem.classList.add("small-textarea"),this.descriptionElem.innerHTML="\n\t\t\t<p>\n\t\t\t\tImports the entire raid from a WCL report.<br>\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tTo import, paste the WCL report and fight link (https://classic.warcraftlogs.com/reports/REPORTID#fight=FIGHTID).<br>\n\t\t\t\tInclude the fight ID or else the first fight in the report will be used.<br>\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tThe following are imported directly from the report:\n\t\t\t\t<ul>\n\t\t\t\t\t<li>Player Name</li>\n\t\t\t\t\t<li>Equipment (items, enchants, and gems)</li>\n\t\t\t\t\t<li>Faction (Alliance / Horde)</li>\n\t\t\t\t\t<li>Encounter: If the import link has a fight ID we try to match with a preset Encounter. Note that many Encounters are still unimplemented.</li>\n\t\t\t\t</ul>\n\n\t\t\t\tThe following are not available directly from the report data, but we try to infer them:\n\t\t\t\t<ul>\n\t\t\t\t\t<li>Talents: Log data only gives us the tree summary (e.g. '51/20/0') so we match this with the closest preset talent build.</li>\n\t\t\t\t\t<li>Glyphs: Glyphs are absent from log data, but we pair them with the inferred Talents.</li>\n\t\t\t\t\t<li>Race: Inferred from Race-specific abilties used in any fight if possible, or defaults to Spec-specific Race.</li>\n\t\t\t\t\t<li>Professions: Inferred from profession-locked items/enchants/gems.</li>\n\t\t\t\t\t<li>Buff assignments (Innervate, Unholy Frenzy, etc): Inferred from casts.</li>\n\t\t\t\t\t<li>Party Composition: Inferred from party-only effects, such as Heroic Presence, Prayer of Healing, or Vampiric Touch.</li>\n\t\t\t\t</ul>\n\n\t\t\t\tThe following are not imported, and instead use spec-specific defaults:\n\t\t\t\t<ul>\n\t\t\t\t\t<li>Rotation / Spec-specific options</li>\n\t\t\t\t\t<li>Consumes</li>\n\t\t\t\t\t<li>Paladin Blessings</li>\n\t\t\t\t</ul>\n\t\t\t</p>\n\t\t"}async getWCLBearerToken(){if(""==this.token){const t=await fetch("https://classic.warcraftlogs.com/oauth/token",{method:"POST",headers:{Authorization:"Basic "+btoa("963d31c8-7efa-4dde-87cf-1b254a8a2f8c:lRJVhujEEnF96xfUoxVHSpnqKN9v8bTqGEjutsO3")},body:new URLSearchParams({grant_type:"client_credentials"})}),e=await t.json();this.token=e.access_token}return this.token}async queryWCL(t){const e={"Content-Type":"application/json",Authorization:`Bearer ${await this.getWCLBearerToken()}`,Accept:"application/json"},a=`https://classic.warcraftlogs.com/api/v2/client?query=${t}`;this.queryCounter++;const s=await fetch(encodeURI(a),{method:"GET",headers:e}),r=await s.json();if(r?.errors?.length){const e=r.errors.map((t=>t.message)).join("\n");throw new Error(`GraphQL error: ${e}\n\nQuery: ${t}`)}return console.debug(`WCL query: ${t}\n\nResult: ${JSON.stringify(r)}`),r}async parseURL(t){const e=t.match(/classic\.warcraftlogs\.com\/reports\/([a-zA-Z0-9:]+)\/?(#.*fight=((\d+)|(last)))?/);if(!e)throw new Error(`Invalid WCL URL ${t}, must look like "classic.warcraftlogs.com/reports/XXXX"`);const a={reportID:e[1],fightID:""};if(e[2]&&e[3]&&"last"!=e[3])a.fightID=e[3];else{const t=`{\n\t\t\t\treportData {\n\t\t\t\t\treport(code: "${a.reportID}") {\n\t\t\t\t\t\tfights(killType: Kills, translate: true) {\n\t\t\t\t\t\t\tid, name\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}`,s=(await this.queryWCL(t)).data.reportData.report.fights;"last"==e[3]?a.fightID=String(s[s.length-1].id):a.fightID=String(s[0].id)}return console.debug(`Importing WCL report: ${JSON.stringify(a)}`),a}async getRateLimit(){return(await this.queryWCL("{\n\t    rateLimitData {\n\t      limitPerHour, pointsSpentThisHour, pointsResetIn\n\t    }\n\t  }")).data.rateLimitData}async onImport(t){this.importButton.disabled=!0,this.rootElem.style.cursor="wait";try{await this.doImport(t)}catch(e){console.error(e),alert("Failed import from WCL: "+e)}this.importButton.disabled=!1,this.rootElem.style.removeProperty("cursor")}async doImport(t){if(!t.length)throw new Error("No import link provided!");const e=await this.parseURL(t);await this.getRateLimit();const a=`{\n\t\t\treportData {\n\t\t\t\treport(code: "${e.reportID}") {\n\t\t\t\t\tguild {\n\t\t\t\t\t\tname faction {id}\n\t\t\t\t\t}\n\t\t\t\t\tplayerDetails: table(fightIDs: [${e.fightID}], dataType: Casts, killType: All, viewBy: Default)\n\t\t\t\t\tcombatantInfoEvents: events(fightIDs: [${e.fightID}], dataType:CombatantInfo, limit: 50) { data }\n\t\t\t\t\tfights(fightIDs: [${e.fightID}]) {\n\t\t\t\t\t\tstartTime, endTime, id, name\n\t\t\t\t\t}\n\n\t\t\t\t\treportCastEvents: events(dataType:Casts, endTime: 99999999, filterExpression: "${[$e,je].flat().map((t=>t.id)).map((t=>`ability.id = ${t}`)).join(" OR ")}", limit: 10000) { data }\n\n\t\t\t\t\tfightCastEvents: events(fightIDs: [${e.fightID}], dataType:Casts, filterExpression: "${[Ve].flat().map((t=>t.id)).map((t=>`ability.id = ${t}`)).join(" OR ")}", limit: 10000) { data }\n\n\t\t\t\t\tfightHealEvents: events(fightIDs: [${e.fightID}], dataType:Healing, filterExpression: "${[qe,ze].flat().map((t=>t.id)).map((t=>`ability.id = ${t}`)).join(" OR ")}", limit: 10000) { data }\n\n\t\t\t\t\tmanaTideTotem: events(fightIDs: [${e.fightID}], dataType:Resources, filterExpression: "ability.id = 39609", limit: 100) { data }\n\t\t\t\t}\n\t\t\t}\n\t\t}`,s=(await this.queryWCL(a)).data.reportData.report,r=s.playerDetails.data.entries;o.freezeAllAndDo((()=>{const t=o.nextEventID(),e=r.map((e=>new Me(e,this.simUI,t)));this.inferRace(t,s,e),this.inferProfessions(t,s,e),this.inferAssignments(t,s,e),this.inferPartyComposition(t,s,e);const a=e.filter((t=>t.player.getClass()==h.ClassPaladin)).length,i=X.create({encounter:this.getEncounterProto(s),raid:this.getRaidProto(e),blessings:q(a)});this.simUI.clearRaid(t),this.simUI.fromProto(t,i)})),this.close()}inferRace(t,e,a){a.forEach((e=>e.player.setRace(t,_.RaceUnknown)));let s=e.guild?.faction?.id||this.simUI.raidPicker?.getCurrentFaction()||i.Horde;e.combatantInfoEvents.data.forEach((e=>{e.auras.filter((t=>28878==t.ability)).forEach((e=>{const r=a.find((t=>t.id==e.source));r&&r.player.getRace()!=_.RaceDraenei&&(console.log(`Inferring player ${r.name} has race ${Q.get(_.RaceDraenei)} from Heroic Presence aura event`),r.player.setRace(t,_.RaceDraenei),s=i.Alliance)}))}));const r=Y(e.reportCastEvents.data,(t=>String(t.abilityGameID)));$e.forEach((e=>{(r[e.id]||[]).forEach((r=>{const i=a.find((t=>t.id==r.sourceID));i&&(console.log(`Inferring player ${i.name} has race ${Q.get(e.race)} from ${e.name} event`),i.player.setRace(t,e.race),s=Z[e.race])}))})),a.forEach((e=>{e.player.getRace()==_.RaceUnknown&&e.player.setRace(t,e.preset.defaultFactionRaces[s])}))}inferProfessions(t,e,a){const s=Y(e.reportCastEvents.data,(t=>String(t.abilityGameID)));je.forEach((t=>{(s[t.id]||[]).forEach((e=>{const s=a.find((t=>t.id==e.sourceID));s&&!s.inferredProfessions.includes(t.profession)&&(console.log(`Inferring player ${s.name} has profession ${tt.get(t.profession)} from ${t.name} event`),s.inferredProfessions.push(t.profession))}))})),a.forEach((e=>{let a=et(e.inferredProfessions.concat(e.player.getGear().getProfessionRequirements()));0==a.length?a=[g.Engineering,g.Jewelcrafting]:1==a.length&&(a[0]!=g.Engineering?a.push(g.Engineering):a.push(g.Jewelcrafting)),e.player.setProfessions(t,a)}))}inferAssignments(t,e,a){const s=Y(e.fightCastEvents.data,(t=>String(t.abilityGameID)));Ve.forEach((e=>{(s[e.id]||[]).forEach((s=>{const r=a.find((t=>t.id==s.sourceID)),i=a.find((t=>t.id==s.targetID));if(r&&i&&r.player.getClass()==e.class){const a=e.applyFunc(r.player,i.toUnitReference());r.player.setSpecOptions(t,a),console.log(`Inferring player ${r.name} is targeting ${i.name} with ${e.name} from cast event`)}}))}))}inferPartyComposition(t,e,a){const s=(t,e,a)=>{(t.addPlayerInParty(e)||e.addPlayerInParty(t))&&console.log(`Inferring players ${t.name} and ${e.name} in same party from ${a} event`)},r=Y(e.fightHealEvents.data,(t=>String(t.abilityGameID)));qe.forEach((t=>{(r[t.id]||[]).forEach((e=>{const r=a.find((t=>t.id==e.sourceID)),i=a.find((t=>t.id==e.targetID));r&&i&&s(r,i,t.name)}))})),ze.forEach((t=>{const e=r[t.id]||[],i=Y(e,(t=>String(t.timestamp)+String(t.sourceID)));for(const[r,n]of Object.entries(i)){const e=n.map((t=>a.find((e=>e.id==t.targetID))));for(let a=0;a<e.length;a++)for(let r=0;r<e.length;r++)a!=r&&e[a]&&e[r]&&s(e[a],e[r],t.name)}})),e.combatantInfoEvents.data.forEach((t=>{const e=a.find((e=>e.id==t.sourceID));t.auras.filter((t=>28878==t.ability)).forEach((t=>{const r=a.find((e=>e.id==t.source));r&&e&&s(r,e,"Heroic Presence")}))}));let i=a.filter((t=>t.playersInParty.length>0)),n=0;for(;i.length>0;){let t=[i[0]].concat(i[0].playersInParty),e=0;for(;t.length!=e;)e=t.length,t=et(t.map((t=>[t].concat(t.playersInParty))).flat());const a=n;n++,t.forEach(((t,e)=>{t.raidIndex=5*a+e})),i=i.filter((e=>!t.includes(e)))}const l=[...Array(40).keys()];a.filter((t=>-1==t.raidIndex)).forEach((t=>{const e=l.find((t=>!a.some((e=>e.raidIndex==t))))??-1;if(-1==e)throw new Error("Invalid next idx");t.raidIndex=e}))}getEncounterProto(t){const e=t.fights[0],a=at.create({duration:(e.endTime-e.startTime)/1e3,targets:[]});let s=this.simUI.sim.db.getAllPresetEncounters().find((t=>t.path.includes(e.name)));return s&&s.targets.length&&s.targets.map((t=>t.target)).filter((t=>void 0!==t)).forEach((t=>a.targets.push(t))),0===a.targets.length&&a.targets.push(vt.defaultTargetProto()),a}getRaidProto(t){const e=M.create({parties:[...new Array(Tt).keys()].map((t=>st.create({players:[...new Array(5).keys()].map((t=>c.create()))})))});return t.forEach((t=>{const a=t.raidIndex%5,s=(t.raidIndex-a)/5,r=t.player.toProto();e.parties[s].players[a]=r,y(d(r))&&e.tanks.push(t.toUnitReference())})),e}}class Me{constructor(t,a,s){e(this,"data"),e(this,"id"),e(this,"name"),e(this,"type"),e(this,"raidIndex",-1),e(this,"simUI"),e(this,"fullType"),e(this,"spec"),e(this,"player"),e(this,"preset"),e(this,"inferredProfessions",[]),e(this,"playersInParty",[]),this.simUI=a,this.data=t,this.name=t.name,this.id=t.id,this.type=t.type;const r=t.icon.split("-")[1];this.fullType=this.type+r,console.log(`WCL spec: ${this.fullType}`);const i=He[this.fullType]??null;if(null==i)throw new Error("Player type not implemented: "+this.fullType);if(this.spec=i,this.player=new ut(this.spec,a.sim),this.preset=Me.getMatchingPreset(i,t.talents),void 0===this.preset)throw new Error("Could not find matching preset: "+JSON.stringify({name:this.name,type:this.fullType,talents:t.talents}).toString());this.player.applySharedDefaults(s),this.player.setTalentsString(s,this.preset.talents.talentsString),this.player.setGlyphs(s,this.preset.talents.glyphs),this.player.setConsumes(s,this.preset.consumes),this.player.setSpecOptions(s,this.preset.specOptions),this.player.setProfessions(s,[g.Engineering,g.Jewelcrafting]),this.player.setName(s,t.name),this.player.setGear(s,a.sim.db.lookupEquipmentSpec(rt.create({items:t.gear.map((t=>it.create({id:t.id,enchant:t.permanentEnchant,gems:t.gems?t.gems.map((t=>t.id)):[]})))})))}static getMatchingPreset(t,e){const a=Zt.filter((e=>e.spec==t));let s=0;if(a&&a.length>1){let t=999;a.forEach(((a,r)=>{const i=nt(a.talents.talentsString),n=i.reduce(((t,a,s)=>t+Math.abs(e[s]?.guid-i[s])),0);n<t&&(s=r,t=n)}))}return a[s]}toUnitReference(){return j.create({type:lt.Player,index:this.raidIndex})}addPlayerInParty(t){return t!=this&&!this.playersInParty.includes(t)&&(this.playersInParty.push(t),!0)}}const He={DeathKnightBlood:s.SpecTankDeathknight,DeathKnightLichborne:s.SpecTankDeathknight,DeathKnightRuneblade:s.SpecDeathknight,DeathKnightBloodDPS:s.SpecDeathknight,DeathKnightFrost:s.SpecDeathknight,DeathKnightUnholy:s.SpecDeathknight,DruidBalance:s.SpecBalanceDruid,DruidFeral:s.SpecFeralDruid,DruidWarden:s.SpecFeralTankDruid,DruidGuardian:s.SpecFeralTankDruid,DruidRestoration:s.SpecRestorationDruid,HunterBeastMastery:s.SpecHunter,HunterSurvival:s.SpecHunter,HunterMarksmanship:s.SpecHunter,MageArcane:s.SpecMage,MageFire:s.SpecMage,MageFrost:s.SpecMage,PaladinHoly:s.SpecHolyPaladin,PaladinJusticar:s.SpecProtectionPaladin,PaladinProtection:s.SpecProtectionPaladin,PaladinRetribution:s.SpecRetributionPaladin,PriestHoly:s.SpecHealingPriest,PriestDiscipline:s.SpecHealingPriest,PriestShadow:s.SpecShadowPriest,PriestSmite:s.SpecSmitePriest,RogueAssassination:s.SpecRogue,RogueCombat:s.SpecRogue,RogueSubtlety:s.SpecRogue,ShamanElemental:s.SpecElementalShaman,ShamanEnhancement:s.SpecEnhancementShaman,ShamanRestoration:s.SpecRestorationShaman,WarlockDestruction:s.SpecWarlock,WarlockAffliction:s.SpecWarlock,WarlockDemonology:s.SpecWarlock,WarriorArms:s.SpecWarrior,WarriorFury:s.SpecWarrior,WarriorChampion:s.SpecWarrior,WarriorWarrior:s.SpecWarrior,WarriorGladiator:s.SpecWarrior,WarriorProtection:s.SpecProtectionWarrior},$e=[{id:25046,name:"Arcane Torrent (Energy)",race:_.RaceBloodElf},{id:28730,name:"Arcane Torrent (Mana)",race:_.RaceBloodElf},{id:50613,name:"Arcane Torrent (Runic Power)",race:_.RaceBloodElf},{id:26297,name:"Berserking",race:_.RaceTroll},{id:20572,name:"Blood Fury (AP)",race:_.RaceOrc},{id:33697,name:"Blood Fury (AP+SP)",race:_.RaceOrc},{id:33702,name:"Blood Fury (SP)",race:_.RaceOrc},{id:20589,name:"Escape Artist",race:_.RaceGnome},{id:20594,name:"Stoneform",race:_.RaceDwarf},{id:20549,name:"War Stomp",race:_.RaceTauren},{id:7744,name:"Will of the Forsaken",race:_.RaceUndead},{id:59752,name:"Will to Survive",race:_.RaceHuman}],je=[{id:55503,name:"Lifeblood",profession:g.Herbalism},{id:50305,name:"Skinning",profession:g.Skinning}],Ve=[{id:29166,name:"Innervate",class:h.ClassDruid,applyFunc:(t,e)=>{const a=t.getSpecOptions();return a.innervateTarget=e,a}},{id:10060,name:"Power Infusion",class:h.ClassPriest,applyFunc:(t,e)=>{const a=t.getSpecOptions();return a.powerInfusionTarget=e,a}},{id:57933,name:"Tricks of the Trade",class:h.ClassRogue,applyFunc:(t,e)=>{const a=t.getSpecOptions();return a.tricksOfTheTradeTarget=e,a}},{id:49016,name:"Unholy Frenzy",class:h.ClassDeathknight,applyFunc:(t,e)=>{const a=t.getSpecOptions();return a.unholyFrenzyTarget=e,a}}],qe=[{id:52042,name:"Healing Stream Totem"},{id:48076,name:"Holy Nova"},{id:48445,name:"Tranquility"},{id:15290,name:"Vampiric Embrace"}],ze=[{id:48072,name:"Prayer of Healing"}],Ne=[];new class extends wt{constructor(t,a){super(t,new Rt,{cssClass:"raid-sim-ui",cssScheme:"raid",spec:null,launchStatus:Ot,knownIssues:(a.knownIssues||[]).concat(Ne)}),e(this,"config"),e(this,"raidSimResultsManager",null),e(this,"raidPicker",null),e(this,"blessingsPicker",null),e(this,"compChangeEmitter",new o),e(this,"changeEmitter",new o),e(this,"referenceChangeEmitter",new o),this.config=a,this.sim.raid.compChangeEmitter.on((t=>this.compChangeEmitter.emit(t))),[this.compChangeEmitter,this.sim.changeEmitter].forEach((t=>t.on((t=>this.changeEmitter.emit(t))))),this.changeEmitter.on((()=>this.recomputeSettingsLayout())),this.sim.setModifyRaidProto((t=>this.modifyRaidProto(t))),this.sim.waitForInit().then((()=>this.loadSettings())),this.addSidebarComponents(),this.addTopbarComponents(),this.addRaidTab(),this.addSettingsTab(),this.addDetailedResultsTab()}loadSettings(){const t=o.nextEventID();o.freezeAllAndDo((()=>{let e=!1;const a=window.localStorage.getItem(this.getSettingsStorageKey());if(null!=a)try{const s=X.fromJsonString(a);this.fromProto(t,s),e=!0}catch(s){console.warn("Failed to parse saved settings: "+s)}e||this.applyDefaults(t),this.changeEmitter.on((t=>{const e=X.toJsonString(this.toProto());window.localStorage.setItem(this.getSettingsStorageKey(),e)}))}))}addSidebarComponents(){this.raidSimResultsManager=ot(this),this.raidSimResultsManager.changeEmitter.on((t=>this.referenceChangeEmitter.emit(t)))}addTopbarComponents(){this.simHeader.addImportLink("JSON",(t=>new Ae(this.rootElem,this))),this.simHeader.addImportLink("WCL",(t=>new Be(this.rootElem,this))),this.simHeader.addExportLink("JSON",(t=>new Le(this.rootElem,this)))}addRaidTab(){new Ee(this.simTabContentsContainer,this)}addSettingsTab(){new xe(this.simTabContentsContainer,this)}addDetailedResultsTab(){this.addTab("Results","detailed-results-tab",'\n\t\t\t<div class="detailed-results">\n\t\t\t</div>\n\t\t'),new ct(this.rootElem.getElementsByClassName("detailed-results")[0],this,this.raidSimResultsManager)}recomputeSettingsLayout(){window.dispatchEvent(new Event("resize"))}modifyRaidProto(t){const e=this.getClassCount(h.ClassPaladin),a=this.blessingsPicker.getAssignments();te.forEach((s=>{const r=t.parties.map((t=>t.players.filter((t=>t.class!=h.ClassUnknown&&d(t)==s)))).flat();a.paladins.forEach(((t,a)=>{a>=e||(t.blessings[s]==N.BlessingOfKings?r.forEach((t=>t.buffs.blessingOfKings=!0)):t.blessings[s]==N.BlessingOfMight?r.forEach((t=>t.buffs.blessingOfMight=dt.TristateEffectImproved)):t.blessings[s]==N.BlessingOfWisdom?r.forEach((t=>t.buffs.blessingOfWisdom=dt.TristateEffectImproved)):t.blessings[s]==N.BlessingOfSanctuary&&r.forEach((t=>t.buffs.blessingOfSanctuary=!0)))}))}))}getCurrentData(){return this.raidSimResultsManager?this.raidSimResultsManager.getCurrentData():null}getReferenceData(){return this.raidSimResultsManager?this.raidSimResultsManager.getReferenceData():null}getActivePlayers(){return this.sim.raid.getActivePlayers()}getClassCount(t){return this.getActivePlayers().filter((e=>e.isClass(t))).length}applyDefaults(t){o.freezeAllAndDo((()=>{this.sim.raid.fromProto(t,M.create({numActiveParties:5})),this.sim.setPhase(t,1),this.sim.encounter.applyDefaults(t),this.sim.applyDefaults(t,!0,!0),this.sim.setShowDamageMetrics(t,!0)}))}toProto(){return X.create({settings:this.sim.toProto(),raid:this.sim.raid.toProto(!0),blessings:this.blessingsPicker.getAssignments(),encounter:this.sim.encounter.toProto()})}toLink(){const t=this.toProto();t.settings=void 0;const e=X.toBinary(t),a=pako.deflate(e,{to:"string"}),s=btoa(String.fromCharCode(...a)),r=new URL(window.location.href);return r.hash=s,r.toString()}fromProto(t,e){o.freezeAllAndDo((()=>{e.settings&&this.sim.fromProto(t,e.settings),this.sim.raid.fromProto(t,e.raid||M.create()),this.sim.encounter.fromProto(t,e.encounter||at.create()),this.blessingsPicker.setAssignments(t,e.blessings||H.create())}))}clearRaid(t){this.sim.raid.clear(t)}getStorageKey(t){return"__wotlk_raid__"+t}getSavedRaidStorageKey(){return this.getStorageKey("__savedRaid__")}}(document.body,{});
//# sourceMappingURL=index-089f91ea.entry.js.map
